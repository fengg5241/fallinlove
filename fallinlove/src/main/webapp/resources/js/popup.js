(function(b,a,c){b.fn.popup=function(n){var e=b(this),g,q,k,v,u,w,h={bgId:n.bgId,openId:n.openId,follow:true,bgOpacity:0.4,position:"absolute",effect:"normal",autoOpen:false},n=b.extend(h,n||{}),r=function(){return b.browser.msie&&(b.browser.version=="6.0")&&!b.support.style?true:false},l=function(){return b.browser.msie&&b.browser.version=="10.0"?true:false},i=function(C,B){var z=["Webkit","Moz","O","ms",""];for(var y in B){if(y.charAt(0)=="$"){for(var A=0;A<z.length;A++){C.style[z[A]+y.substring(1)]=B[y]}}else{if(typeof B[y]=="number"){switch(B[y]){case"opacity":if(value<0){value=0}C.style.filter="alpha(opacity:"+value+")";C.style.opacity=value/100;break;default:C.style[y]=B[y]+"px"}}else{if(typeof B[y]=="string"){C.style[y]=B[y]}}}}},s=function(){g=b(document).width();q=b(document).height();k=b(a).width();v=b(a).height();u=n.position=="fixed"?0:b(document).scrollTop();w=n.position=="fixed"?0:b(document).scrollLeft()},j=function(y){return y.css("display")=="none"?true:false},f=function(){if(a.navigator.userAgent.search("MetaSr")!=-1){return true}else{return b.browser.msie&&parseInt(b.browser.version)<=9||b.browser.safari&&b.browser.version<=537.31?false:true}},o=function(A,z,y){return A<z?z:A>y?y:A},t=function(z){if(!n.moveId){return}var y=0,A=0;n.moveId.hover(function(){b(this).css({cursor:"move"})},function(){b(this).css({cursor:"default"})});n.moveId.bind("mousedown",function(B){b(this).css({cursor:"move"});y=B.pageX-z.offset().left;A=B.pageY-z.offset().top;b(document).bind("mousemove",function(E){var C=o(E.pageX-y,0,k-n.openId.outerWidth()),D=o(E.pageY-A,0,q-n.openId.outerHeight());if(n.effect=="3d"&&f()){b("#popup_parent").css({left:C,top:D})}else{z.css({left:C,top:D})}if(n.openId[0].setCapture){n.openId[0].setCapture()}});b(document).bind("mouseup",function(){b(document).unbind("mousemove");b(document).unbind("mouseup");if(n.openId[0].releaseCapture){n.openId[0].releaseCapture()}n.moveId.css({cursor:"default"})});return false})},p=function(){if(n.effect=="normal"){n.bgId.hide();n.openId.hide()}else{if(n.effect=="fade"){n.bgId.hide();n.openId.hide()}else{if(n.effect=="3d"){if(f()){n.bgId.hide();n.openId.hide();b(document.body).append(n.openId);b("#popup_parent").remove()}else{n.bgId.hide();n.openId.hide()}}}}},x=function(){if(n.effect=="normal"){n.bgId.show();n.openId.show()}else{if(n.effect=="fade"){n.bgId.show();n.openId.fadeIn()}else{if(n.effect=="3d"){n.bgId.show();n.openId.show();if(f()){n.bgId.fadeIn();i(n.openId[0],{$Transform:"rotateY(-180deg) translateZ(0px)",top:0,opacity:100});var C=n.openId.outerHeight(),A=n.openId.outerWidth(),z=(k-n.openId.outerWidth())/2+w,B=(v-n.openId.outerHeight())/2+u,y=b('<div id="popup_parent"></div>');y.append(n.openId);i(y[0],{$TransformStyle:"preserve-3d",$Perspective:"800px",width:A+1,height:C+1,position:"absolute",top:B,left:z,zIndex:n.bgId.css("zIndex")+1});b(document.body).append(y);n.openId.show();setTimeout(function(){i(n.openId[0],{$Transform:"rotateY(0deg) translateZ(0px)",top:1,left:1,$Transition:"1s all ease",opacity:100})},10)}}}}if(n.position=="fixed"&&n.moveId){n.openId.css({top:(v-n.openId.outerHeight())/2+w,left:(k-n.openId.outerWidth())/2+u,position:"absolute"})}n.openId.find(".popup_close").bind("click",function(){p();return false});if(n.follow&&n.position!="fixed"||r()&&n.position=="fixed"){b(a).bind("scroll",function(){s();m()})}},m=function(){if(j(n.openId)){return}if(n.effect=="3d"&&f()){var y=document.getElementById("popup_parent");b(y).stop(true).animate({top:(v-n.openId.outerHeight())/2+u});n.openId.css({top:1,left:1})}else{n.openId.stop(true).animate({opacity:1,top:u+(b(a).height()-n.openId.outerHeight())/2})}},d=function(){n.bgId.css({width:b(a).width(),height:b(document).height(),opacity:n.bgOpacity});u=n.position=="fixed"?0:b(document).scrollTop();w=n.position=="fixed"?0:b(document).scrollLeft();n.openId.css({zIndex:n.bgId.css("zIndex")+1,position:r()?"absolute":n.position});if(n.effect=="3d"&&f()){i(n.openId[0],{top:1,left:1,$Transition:"0s all 0s ease"})}else{i(n.openId[0],{top:n.openId.attr("id")=="tab_couples-tip1"?-9999:(v-n.openId.outerHeight())/2+u,left:(k-n.openId.outerWidth())/2+w})}if(n.effect=="3d"&&f()){var y=document.getElementById("popup_parent");if(y){i(y,{top:(v-n.openId.outerHeight())/2+u})}}if(n.openId.attr("id")=="tab_couples-tip1"&&b("#tab_couples-tip1").css("top")=="-9999px"){b("#tab_couples-tip1").css({top:-9999})}};this.close=function(){p()};return this.each(function(){s();if(n.autoOpen){d();x();t(n.openId);n.openId.show()}else{e.bind("click",function(){d();x();t(n.openId)})}b(a).bind("resize",function(){s();d()})})}})(jQuery,window);